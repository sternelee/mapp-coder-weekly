(wx.webpackJsonp=wx.webpackJsonp||[]).push([[20],{"23":function(e,t,n){"use strict";n.r(t);var o=n(4),r=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,function(){return o[e]})}(a);t.default=r.a},"4":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var u=_interopRequireDefault(n(22)),j=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],o=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){r=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a,i=n(42),D=n(0),l=_interopRequireDefault(D),s=n(21),p=_interopRequireDefault(n(70));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(r,a){return function step(e,t){try{var n=i[e](t),o=n.value}catch(e){return void a(e)}if(!n.done)return Promise.resolve(o).then(function(e){step("next",e)},function(e){step("throw",e)});r(o)}("next")})}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}n(71);var c,d=["wIZ5aqHfmpQK87nN6SiA4iov86Uy8X05yEDnp-qdgpo"],f=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Index,D.Component),o(Index,[{"key":"_constructor","value":function _constructor(){(function get(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:get(r,t,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0})(Index.prototype.__proto__||Object.getPrototypeOf(Index.prototype),"_constructor",this).apply(this,arguments),this.state={"isAside":!1,"top":0,"nodes":[],"count":0,"isSubscribe":!1,"cids":[],"openid":"","tids":[]},this.$$refs=new l.default.RefsArray}},{"key":"onShareAppMessage","value":function onShareAppMessage(e){var t=this.props.weeklyStore,n=t.tab,o=t.categorys,r=t.cid;return"button"===e.from&&console.log(e.target),{"title":""+o[n].title,"path":"pages/index/index?cid="+r,"success":function success(e){console.log("转发成功:"+JSON.stringify(e))},"fail":function fail(e){console.log("转发失败:"+JSON.stringify(e))}}}},{"key":"componentWillMount","value":(c=_asyncToGenerator(u.default.mark(function _callee4(){var t,n,o,r,a,i;return u.default.wrap(function _callee4$(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.weeklyStore,n=this.$router.params,o=Number(n.cid||1),r=l.default.getMenuButtonBoundingClientRect(),this.setState({"top":r.top+2}),t.cTitle){e.next=8;break}return e.next=8,t.getCategorys();case 8:return a=t.categorys.map(function(e){return Number(e.cid)}),i=a.indexOf(o),t.tab=i,t.cid=o,t.cTitle=t.categorys[i].title,e.next=15,this.getIssues(0);case 15:case"end":return e.stop()}},_callee4,this)})),function componentWillMount(){return c.apply(this,arguments)})},{"key":"componentWillReact","value":function componentWillReact(){console.log("componentWillReact")}},{"key":"componentDidMount","value":function componentDidMount(){}},{"key":"componentWillUnmount","value":function componentWillUnmount(){}},{"key":"componentDidShow","value":function componentDidShow(){this.checkSetting()}},{"key":"componentDidHide","value":function componentDidHide(){}},{"key":"_createData","value":function _createData(e,t,n){var i=this;this.__state=e||this.state||{},this.__props=t||this.props||{};var c=this.$prefix,o=(0,D.genCompid)(c+"$compid__61"),r=j(o,2),a=r[0],s=r[1],u=(0,D.genCompid)(c+"$compid__62"),l=j(u,2),p=l[0],d=l[1],f=this.__state,g=f.top,_=(f.isAside,f.nodes),y=f.count,h=f.isSubscribe,m=f.cids,v=this.__props.weeklyStore,b=v.categorys,S=v.tab,w=v.issue,x=v.cTitle,k=b.length?b[S].color:"",$=b.length?b[S].maxId:0,T=Number(w.pid);console.log("更新 侧边栏");var C=(0,D.internal_inline_style)({"background":k,"padding":g+"px 0 0 10px","height":"35px"}),I=(0,D.internal_inline_style)({"padding":"10px"}),O=(0,D.internal_inline_style)({"marginTop":g+"px"}),A=h?(0,D.internal_inline_style)({"color":k}):null,z=(0,D.internal_inline_style)({"background":k,"color":"#fff"}),R=(0,D.internal_inline_style)({"marginLeft":"10px","background":k,"fontWeight":0<y?"normal":600,"color":"#fff"}),P=_.length?_.map(function(e,t){e={"$original":(0,D.internal_get_original)(e)};var n=(0,D.genCompid)(c+"dizzzzzzzz"+t,!0),o=j(n,2),r=o[0],a=o[1];return D.propsManager.set({"tag":e.$original.tag,"attrs":e.$original.attrs,"onClick":i.onTarget,"nodes":e.$original.nodes},a,r),{"$compid__59":a,"$original":e.$original}}):[],M=b.map(function(e,t){e={"$original":(0,D.internal_get_original)(e)};var n=(0,D.internal_inline_style)({"background":t===S?k:""}),o=h?m.includes(Number(e.$original.cid))?"check1":"check":null,r=(0,D.genCompid)(c+"djzzzzzzzz"+t,!0),a=j(r,2),i=a[0],s=a[1];return h&&D.propsManager.set({"name":o,"size":50,"color":t===S?"#fff":k},s,i),{"$loopState__temp6":n,"$loopState__temp8":o,"$compid__60":s,"$original":e.$original}});return D.propsManager.set({"name":"caidan","size":50,"color":"#fff"},s,a),D.propsManager.set({"name":"caidan","size":80,"color":k},d,p),Object.assign(this.__state,{"anonymousState__temp":C,"anonymousState__temp2":I,"anonymousState__temp3":O,"anonymousState__temp4":A,"anonymousState__temp9":z,"anonymousState__temp10":R,"loopArray20":P,"loopArray21":M,"$compid__61":s,"$compid__62":d,"curId":T,"maxId":$,"tab":S,"categorys":b,"cTitle":x,"issue":w}),this.__state}}]),a=r=Index,r.$$events=["onAside","onPage","onCategory","onCheck","onSubscribe"],r.$$componentPath="pages/index/index",a);function Index(){var e,t,a,n,o,r=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Index);for(var i=arguments.length,s=Array(i),c=0;c<i;c++)s[c]=arguments[c];return(t=a=_possibleConstructorReturn(this,(e=Index.__proto__||Object.getPrototypeOf(Index)).call.apply(e,[this].concat(s)))).$usedState=["anonymousState__temp","anonymousState__temp2","anonymousState__temp3","anonymousState__temp4","anonymousState__temp9","anonymousState__temp10","loopArray20","loopArray21","$compid__61","$compid__62","curId","maxId","nodes","isAside","isSubscribe","tab","categorys","cTitle","issue","count","top","cids","openid","tids","weeklyStore"],a.config={"navigationBarTitleText":"","navigationStyle":"custom"},a.getIssues=_asyncToGenerator(u.default.mark(function _callee(){var t,n,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return u.default.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return l.default.showLoading({"title":"Loading . . ."}),e.next=3,a.props.weeklyStore.getIssues(o);case 3:if(t=e.sent,l.default.hideLoading(),t){e.next=7;break}return e.abrupt("return",l.default.showToast({"title":"没有数据","duration":1e3}));case 7:n=(0,p.default)(t),a.setState({"nodes":n});case 9:case"end":return e.stop()}},_callee,r)})),a.onCategory=(o=_asyncToGenerator(u.default.mark(function _callee2(t){return u.default.wrap(function _callee2$(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),a.setState({"isAside":!1,"nodes":[]}),e.next=4,a.props.weeklyStore.setCategory(t);case 4:return e.next=6,a.getIssues(0);case 6:case"end":return e.stop()}},_callee2,r)})),function(e){return o.apply(this,arguments)}),a.onAside=function(){var e=a.state.isAside;console.log("isAside",e),a.setState({"isAside":!e})},a.onPage=(n=_asyncToGenerator(u.default.mark(function _callee3(t){return u.default.wrap(function _callee3$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getIssues(t);case 2:case"end":return e.stop()}},_callee3,r)})),function(e){return n.apply(this,arguments)}),a.onTarget=function(e,t){console.log(e,t);var n=/Unsubscribe/i.test(t),o=/Read on the Web/i.test(t);if(a.props.weeklyStore.setTarget(e),n||o)l.default.setClipboardData({"data":e,"success":function success(){l.default.showToast({"title":"复制成功","duration":1e3})}});else{var r=e.match(/\/([\d]+)\//)[1];l.default.navigateTo({"url":"/pages/post/index?cid="+a.props.weeklyStore.cid+"&id="+r})}},a.checkSetting=function(){l.default.getSetting({"withSubscriptions":!0,"success":function success(e){if(console.log(e),e.subscriptionsSetting){var t=e.subscriptionsSetting,n=d.filter(function(e){return t[e]&&"accept"===t[e]});a.setState({"tids":n,"count":n.length})}},"fail":function fail(e){console.log("getSetting",e)}}),l.default.getStorage({"key":"cids","success":function success(e){a.setState({"cids":e.data})}});try{var e=l.default.getStorageSync("openid");if(!e)return a.onLogin();a.setState({"openid":e})}catch(e){a.onLogin()}},a.onLogin=function(){l.default.login({"success":function success(e){l.default.request({"url":"https://api.leeapps.cn/koa/auth?js_code="+e.code}).then(function(e){console.log(e),a.setState({"openid":e.data.openid}),l.default.setStorage({"key":"openid","data":e.data.openid})})}})},a.onSubscribe=function(){a.state.isSubscribe?a.onReuestMessage():a.setState({"isSubscribe":!0})},a.onCheck=function(e){var t=a.state.cids,n=Number(e);t.includes(n)?t=t.filter(function(e){return e!=n}):t.push(n),a.setState({"cids":t})},a.onReuestMessage=function(){var n=a.state.cids;l.default.requestSubscribeMessage({"tmplIds":[d[0]],"success":function success(t){a.setState({"isSubscribe":!1});var e=d.filter(function(e){return t[e]&&"accept"===t[e]});0!==e.length&&(l.default.setStorage({"key":"cids","data":n}),a.setState({"tids":e},function(){return a.saveSubscribe()}))}})},a.saveSubscribe=function(){var e=a.state,t=e.openid,n=e.cids,o=e.tids;l.default.request({"method":"POST","url":"https://api.leeapps.cn/koa/weekly/subscribe","data":{"openid":t,"cids":n,"tids":o}}).then(function(e){e.data&&0===e.data.code?l.default.showToast({"title":"订阅成功","icon":"success","duration":1e3}):l.default.showToast({"title":"订阅失败,请重试","duration":1e3})})},a.customComponents=["IconFont","RenderView"],_possibleConstructorReturn(a,t)}f=(0,i.__decorate)([(0,s.inject)("weeklyStore"),s.observer],f),t.default=f,Component(n(0).default.createComponent(f,!0))},"41":function(e,t,n){e.exports=n.p+"pages/index/index.wxml"},"68":function(e,t,n){"use strict";n.r(t);n(69);var o=n(23);for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r)},"69":function(e,t,n){"use strict";n(41)},"70":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var o="([a-zA-Z_][\\w\\-\\.]*)",a=/^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,i=new RegExp("^<"+o),s=/^\s*(\/?)>/,r=new RegExp("^<\\/"+o+"[^>]*>"),c=void 0,u=0,l=void 0,p=void 0,d=[];function advance(e){u+=e,c=c.substring(e)}function parseStartTag(){var e=c.match(i);if(e){var t={"tagName":e[1],"attrs":{},"start":u};advance(e[0].length);for(var n=void 0,o=void 0;!(n=c.match(s))&&(o=c.match(a));)advance(o[0].length),t.attrs[o[1]]=o[3];n&&(t.unarySlash=n[1],advance(n[0].length));var r=function createASTElement(e,t){return{"tag":e.toLowerCase(),"attrs":t,"nodes":[]}}(t.tagName,t.attrs);l=l||r,p&&p.nodes.push(r),t.unarySlash||(d.push(r),p=r)}}function parseEndTag(){var e=c.match(r);if(e){advance(e[0].length);var t=e[1].toLowerCase(),n=void 0;for(n=d.length-1;0<=n&&d[n].tag!==t;n--);0<=n&&(d.length=n,p=d[d.length-1])}}t.default=function parser(e){for(c="<body>"+e+"</body>";c;){var t=c.indexOf("<");if(0===t){if(c.match(i)){parseStartTag();continue}if(c.match(r)){parseEndTag();continue}}var n=void 0;0<=t&&(n=c.substring(0,t),advance(t)),t<0&&(n=c,c=""),n&&((o=n).replace(/ /g,"")&&p.nodes.push({"tag":"text","text":o}))}var o;return setTimeout(function(){return function init(){c="",u=0,p=l=null,d=[]}()},1e3),l.nodes}},"71":function(e,t,n){}},[[68,0,1]]]);
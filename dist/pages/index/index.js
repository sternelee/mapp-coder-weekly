(wx.webpackJsonp=wx.webpackJsonp||[]).push([[20],{"23":function(e,t,n){"use strict";n.r(t);var o=n(4),a=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);t.default=a.a},"4":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var u=_interopRequireDefault(n(22)),D=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],o=!0,a=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{!o&&s.return&&s.return()}finally{if(a)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a,r,i=n(42),j=n(0),l=_interopRequireDefault(j),s=n(21),p=_interopRequireDefault(n(70));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(a,r){return function step(e,t){try{var n=i[e](t),o=n.value}catch(e){return void r(e)}if(!n.done)return Promise.resolve(o).then(function(e){step("next",e)},function(e){step("throw",e)});a(o)}("next")})}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}n(71);var c,d=["wIZ5aqHfmpQK87nN6SiA4iov86Uy8X05yEDnp-qdgpo","wIZ5aqHfmpQK87nN6SiA4kPdtBsIjrbfRZM83eDmSeY","wIZ5aqHfmpQK87nN6SiA4okb5JDOfYQphiaRKH3gUvA"],f=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Index,j.Component),o(Index,[{"key":"_constructor","value":function _constructor(){(function get(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:get(a,t,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(Index.prototype.__proto__||Object.getPrototypeOf(Index.prototype),"_constructor",this).apply(this,arguments),this.state={"isAside":!1,"top":0,"nodes":[],"count":0,"isSubscribe":!1,"cids":[],"openid":""},this.$$refs=new l.default.RefsArray}},{"key":"onShareAppMessage","value":function onShareAppMessage(e){var t=this.props.weeklyStore,n=t.tab,o=t.categorys,a=t.cid;return"button"===e.from&&console.log(e.target),{"title":""+o[n].title,"path":"pages/index/index?cid="+a,"success":function success(e){console.log("转发成功:"+JSON.stringify(e))},"fail":function fail(e){console.log("转发失败:"+JSON.stringify(e))}}}},{"key":"componentWillMount","value":(c=_asyncToGenerator(u.default.mark(function _callee5(){var t,n,o,a,r,i;return u.default.wrap(function _callee5$(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.weeklyStore,n=this.$router.params,o=Number(n.cid||1),a=l.default.getMenuButtonBoundingClientRect(),this.setState({"top":a.top+2}),t.cTitle){e.next=8;break}return e.next=8,t.getCategorys();case 8:return r=t.categorys.map(function(e){return Number(e.cid)}),i=r.indexOf(o),t.tab=i,t.cid=o,t.cTitle=t.categorys[i].title,e.next=15,this.getIssues(0);case 15:case"end":return e.stop()}},_callee5,this)})),function componentWillMount(){return c.apply(this,arguments)})},{"key":"componentWillReact","value":function componentWillReact(){console.log("componentWillReact")}},{"key":"componentDidMount","value":function componentDidMount(){}},{"key":"componentWillUnmount","value":function componentWillUnmount(){}},{"key":"componentDidShow","value":function componentDidShow(){this.checkSetting()}},{"key":"componentDidHide","value":function componentDidHide(){}},{"key":"_createData","value":function _createData(e,t,n){var i=this;this.__state=e||this.state||{},this.__props=t||this.props||{};var c=this.$prefix,o=(0,j.genCompid)(c+"$compid__39"),a=D(o,2),r=a[0],s=a[1],u=(0,j.genCompid)(c+"$compid__40"),l=D(u,2),p=l[0],d=l[1],f=this.__state,g=f.top,_=(f.isAside,f.nodes),h=f.count,y=f.isSubscribe,m=f.cids,v=this.__props.weeklyStore,b=v.categorys,S=v.tab,w=v.issue,x=v.cTitle,k=b.length?b[S].color:"",$=b.length?b[S].maxId:0,T=Number(w.pid),I=(0,j.internal_inline_style)({"background":k,"padding":g+"px 0 0 10px","height":"35px"}),O=(0,j.internal_inline_style)({"padding":"10px"}),A=(0,j.internal_inline_style)({"marginTop":g+"px"}),C=y?(0,j.internal_inline_style)({"color":k}):null,R=(0,j.internal_inline_style)({"background":k,"color":"#fff"}),z=(0,j.internal_inline_style)({"marginLeft":"10px","background":k,"fontWeight":0<h?"normal":600,"color":"#fff"}),P=_.length?_.map(function(e,t){e={"$original":(0,j.internal_get_original)(e)};var n=(0,j.genCompid)(c+"cczzzzzzzz"+t,!0),o=D(n,2),a=o[0],r=o[1];return j.propsManager.set({"tag":e.$original.tag,"attrs":e.$original.attrs,"onClick":i.onTarget,"nodes":e.$original.nodes},r,a),{"$compid__37":r,"$original":e.$original}}):[],M=b.map(function(e,t){e={"$original":(0,j.internal_get_original)(e)};var n=(0,j.internal_inline_style)({"background":t===S?k:""}),o=y?m.includes(Number(e.$original.cid))?"check1":"check":null,a=(0,j.genCompid)(c+"cdzzzzzzzz"+t,!0),r=D(a,2),i=r[0],s=r[1];return y&&j.propsManager.set({"name":o,"size":50,"color":t===S?"#fff":k},s,i),{"$loopState__temp6":n,"$loopState__temp8":o,"$compid__38":s,"$original":e.$original}});return j.propsManager.set({"name":"caidan","size":50,"color":"#fff"},s,r),j.propsManager.set({"name":"caidan","size":80,"color":k},d,p),Object.assign(this.__state,{"anonymousState__temp":I,"anonymousState__temp2":O,"anonymousState__temp3":A,"anonymousState__temp4":C,"anonymousState__temp9":R,"anonymousState__temp10":z,"loopArray12":P,"loopArray13":M,"$compid__39":s,"$compid__40":d,"curId":T,"maxId":$,"tab":S,"categorys":b,"cTitle":x,"issue":w}),this.__state}}]),r=a=Index,a.$$events=["onAside","onPage","onCategory","onCheck","onSubscribe"],a.$$componentPath="pages/index/index",r);function Index(){var e,t,r,n,o,a=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Index);for(var i=arguments.length,s=Array(i),c=0;c<i;c++)s[c]=arguments[c];return(t=r=_possibleConstructorReturn(this,(e=Index.__proto__||Object.getPrototypeOf(Index)).call.apply(e,[this].concat(s)))).$usedState=["anonymousState__temp","anonymousState__temp2","anonymousState__temp3","anonymousState__temp4","anonymousState__temp9","anonymousState__temp10","loopArray12","loopArray13","$compid__39","$compid__40","curId","maxId","nodes","isAside","isSubscribe","tab","categorys","cTitle","issue","count","top","cids","openid","weeklyStore"],r.config={"navigationBarTitleText":"","navigationStyle":"custom"},r.getIssues=_asyncToGenerator(u.default.mark(function _callee(){var t,n,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return u.default.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return l.default.showLoading({"title":"Loading . . ."}),e.next=3,r.props.weeklyStore.getIssues(o);case 3:if(t=e.sent,l.default.hideLoading(),t){e.next=7;break}return e.abrupt("return",l.default.showToast({"title":"没有数据","duration":1e3}));case 7:n=(0,p.default)(t),r.setState({"nodes":n});case 9:case"end":return e.stop()}},_callee,a)})),r.onCategory=(o=_asyncToGenerator(u.default.mark(function _callee2(t){return u.default.wrap(function _callee2$(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),r.setState({"isAside":!1,"nodes":[]}),e.next=4,r.props.weeklyStore.setCategory(t);case 4:return e.next=6,r.getIssues(0);case 6:case"end":return e.stop()}},_callee2,a)})),function(e){return o.apply(this,arguments)}),r.onAside=function(){var e=r.state.isAside;console.log("isAside",e),r.setState({"isAside":!e})},r.onPage=(n=_asyncToGenerator(u.default.mark(function _callee3(t){return u.default.wrap(function _callee3$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getIssues(t);case 2:case"end":return e.stop()}},_callee3,a)})),function(e){return n.apply(this,arguments)}),r.onTarget=function(e,t){console.log(e,t);var n=/Unsubscribe/i.test(t),o=/Read on the Web/i.test(t);if(r.props.weeklyStore.setTarget(e),n||o)l.default.setClipboardData({"data":e,"success":function success(){l.default.showToast({"title":"复制成功","duration":1e3})}});else{var a=e.match(/\/([\d]+)\//)[1];l.default.navigateTo({"url":"/pages/post/index?cid="+r.props.weeklyStore.cid+"&id="+a})}},r.checkSetting=function(){l.default.getSetting({"withSubscriptions":!0,"success":function success(e){if(console.log(e),e.subscriptionsSetting){var t=e.subscriptionsSetting,n=d.filter(function(e){return t[e]&&"accept"===t[e]});r.setState({"count":n.length})}}}),l.default.getStorage({"key":"cids","success":function success(e){r.setState({"cids":e.data})}});try{var e=l.default.getStorageSync("openid");r.setState({"openid":e})}catch(e){r.onLogin()}},r.onLogin=function(){l.default.login({"success":function success(e){l.default.request({"url":"https://api.leeapps.cn/koa/auth?js_code="+e.code}).then(function(e){console.log(e),r.setState({"openid":e.data.openid}),l.default.setStorage({"key":"openid","data":e.data.openid})})}})},r.onSubscribe=function(){r.state.isSubscribe?r.onSubscribeOk():r.setState({"isSubscribe":!0})},r.onCheck=function(e){var t=r.state.cids,n=Number(e);if(t.includes(n))t=t.filter(function(e){return e!=n});else{if(3<=t.length)return;t.push(n)}r.setState({"cids":t})},r.onSubscribeOk=_asyncToGenerator(u.default.mark(function _callee4(){var t;return u.default.wrap(function _callee4$(e){for(;;)switch(e.prev=e.next){case 0:return t=r.state.cids,r.setState({"isSubscribe":!1}),e.next=4,l.default.setStorage({"key":"cids","data":t});case 4:r.onReuestMessage();case 5:case"end":return e.stop()}},_callee4,a)})),r.onReuestMessage=function(){var e=r.state,n=e.openid,o=e.cids;l.default.requestSubscribeMessage({"tmplIds":[d[0]],"success":function success(t){console.log(t);var e=d.filter(function(e){return t[e]&&"accept"===t[e]});0!==e.length&&l.default.request({"method":"POST","url":"https://api.leeapps.cn/koa/weekly/subscribe","data":{"openid":n,"cids":o,"tids":e}}).then(function(e){console.log(e),e.data&&0===e.data.code?(r.setState({"count":1}),l.default.showToast({"title":"订阅成功","icon":"success","duration":1e3})):l.default.showToast({"title":"订阅失败,请重试","duration":1e3})})}})},r.customComponents=["IconFont","RenderView"],_possibleConstructorReturn(r,t)}f=(0,i.__decorate)([(0,s.inject)("weeklyStore"),s.observer],f),t.default=f,Component(n(0).default.createComponent(f,!0))},"41":function(e,t,n){e.exports=n.p+"pages/index/index.wxml"},"68":function(e,t,n){"use strict";n.r(t);n(69);var o=n(23);for(var a in o)"default"!==a&&function(e){n.d(t,e,function(){return o[e]})}(a)},"69":function(e,t,n){"use strict";n(41)},"70":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var o="([a-zA-Z_][\\w\\-\\.]*)",r=/^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,i=new RegExp("^<"+o),s=/^\s*(\/?)>/,a=new RegExp("^<\\/"+o+"[^>]*>"),c=void 0,u=0,l=void 0,p=void 0,d=[];function advance(e){u+=e,c=c.substring(e)}function parseStartTag(){var e=c.match(i);if(e){var t={"tagName":e[1],"attrs":{},"start":u};advance(e[0].length);for(var n=void 0,o=void 0;!(n=c.match(s))&&(o=c.match(r));)advance(o[0].length),t.attrs[o[1]]=o[3];n&&(t.unarySlash=n[1],advance(n[0].length));var a=function createASTElement(e,t){return{"tag":e.toLowerCase(),"attrs":t,"nodes":[]}}(t.tagName,t.attrs);l=l||a,p&&p.nodes.push(a),t.unarySlash||(d.push(a),p=a)}}function parseEndTag(){var e=c.match(a);if(e){advance(e[0].length);var t=e[1].toLowerCase(),n=void 0;for(n=d.length-1;0<=n&&d[n].tag!==t;n--);0<=n&&(d.length=n,p=d[d.length-1])}}t.default=function parser(e){for(c="<body>"+e+"</body>";c;){var t=c.indexOf("<");if(0===t){if(c.match(i)){parseStartTag();continue}if(c.match(a)){parseEndTag();continue}}var n=void 0;0<=t&&(n=c.substring(0,t),advance(t)),t<0&&(n=c,c=""),n&&((o=n).replace(/ /g,"")&&p.nodes.push({"tag":"text","text":o}))}var o;return setTimeout(function(){return function init(){c="",u=0,p=l=null,d=[]}()},1e3),l.nodes}},"71":function(e,t,n){}},[[68,0,1]]]);